pipeline {
  agent {
    docker {
      image 'windsekirun/jenkins-android-docker:1.1.1'
    }
  }
  options {
    skipStagesAfterUnstable()
  }
  stages {
    stage ('Prepare'){
      steps {
        sh 'chmod +x ./gradlew'
      }
    }
    stage('Compile') {
      steps {
      //here error
        sh './gradlew compileDebugSources'
      }
    }
    stage('RuboCop code analyzer') {
  node {
    sh '/var/lib/jenkins/ci-projects/test/build-scripts/run-rubocop-tests.sh'

    publishHTML(target: [
      allowMissing: false,
      alwaysLinkToLastBuild: true,
      keepAll: true,
      reportDir: '/var/lib/jenkins/ci-projects/test/build-reports/',
      reportFiles: 'rubocop-index.html',
      reportName: 'RuboCop HTML Report'
    ])

    step([$class: 'CheckStylePublisher',
      canRunOnFailed: true,
      defaultEncoding: '',
      healthy: '100',
      pattern: '**/rubocop-checkstyle-result.xml',
      unHealthy: '90',
      useStableBuildAsReference: true
    ])
  }
} 
    stage('Unit test') { 
      steps {
           sh './gradlew testDebugUnitTest '
      }
    }
        stage('Build APK') {
      steps {
        sh "./gradlew assembleDebug"
      }
    }
  }
}
