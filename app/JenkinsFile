pipeline {
    agent{
        docker {
            image 'windsekirun/jenkins-android-docker:1.1.1'
        }
     }
     options {
         skipStagesAfterUnstable()
     }
     stages {
         stage ('Prepare'){
             steps {
                 sh 'chmod +x ./gradlew'
             }
         }
         stage('Compile') {
              steps {
                  sh './gradlew compileDebugSources'
              }
         }
         stage('Build APK') {
             steps {
                 sh "./gradlew assembleDebug assembleAndroidTest -PBUILD_NUMBER=${env.BUILD_NUMBER}"
             }
         }
         stage('Unit test') { 
             steps {
                 sh "./gradlew testDebugUnitTest -PBUILD_NUMBER=${env.BUILD_NUMBER}"
             
              }
        }
        stage('UI Testing') {
      steps {
        script {                                                   
          
          // Start your emulator, testing tools
          sh 'emulator @Nexus_Emulator_API_24'
          sh 'appium &'  
     
          // You're set to go, now execute your UI test
          sh 'rspec spec -fd'
          
        }
      }
    }
     }
}
