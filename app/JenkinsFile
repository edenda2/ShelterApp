


pipeline {
    agent{
        docker {
            image 'windsekirun/jenkins-android-docker:1.1.1'
        }
     }
     options {
         skipStagesAfterUnstable()
     }
     stages {
         stage ('Prepare'){
             steps {
                 sh 'chmod +x ./gradlew'
                 sh 'chmod +x ./emulator'

             }
         }
         
               stage('Start Emulator') { 
             steps {
             sh ' ./emulator'

                   }
               }
         
         
         stage('Compile') {
              steps {
                  sh './gradlew compileDebugSources'
              }
         }
         
         
           stage('Lint and Unit Test'){
      parallel {
        stage('lint'){
          steps{
            script {
              try {
                sh './gradlew lint'
              } catch (Exception e) {
                echo e.getMessage()
                echo "Lint failed"
              }
            }       
          }
        }
        stage('test'){
          steps{
            script {
              try {
                sh './gradlew test'
              } catch (Exception e) {
                echo e.getMessage()
                echo "test failed"
              }
            }       
          }   
        }
      }
    }
    stage('createAPK'){
      steps{
        sh './gradlew assembleRelease'  
      }
    }
  }
         
         
   
      
              
              
     }

