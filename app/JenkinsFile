pipeline{
  	agent {
		docker {
	  		image 'windsekirun/jenkins-android-docker:1.1.1'
		}
 	}
  	options {
		skipStagesAfterUnstable()
  	}
    	stages {
		stage('Prepare') {
	  		steps {
				sh 'chmod +x ./gradlew'
	  		}
		}
		stage('Compile') {
	  		steps {
				sh './gradlew compileDebugSources'
	  		}
		}
		stage('Unit test') {
	  		steps {
				script{
					sh './gradlew clean test --no-daemon'
					junit '**/build/test-results/testDebugUnitTest/*.xml'
	  				//sh "./gradlew testDebugUnitTest -PBUILD_NUMBER=${env.BUILD_NUMBER}"
	  			}
			}
		}
		stage('Build APK') {
	  		steps {
				sh "./gradlew assembleDebug'
				//sh "./gradlew assembleDebug assembleAndroidTest -PBUILD_NUMBER=${env.BUILD_NUMBER}"
	  		}
		}
	}
}
